# 主从模型

**主节点（Master）**：

1. **数据写入与更新**：
   主节点负责接收所有的写入请求（如增删改操作），执行相应的业务逻辑，并将数据变更持久化到本地存储（如数据库）。主节点确保数据的完整性和一致性。
2. **数据同步**：
   主节点在完成数据变更后，负责将变更信息（如日志、binlog、变更集）发送给从节点。主节点通常采用异步或半同步的方式进行数据同步，以降低同步延迟对写入性能的影响。
3. **心跳检测与故障检测**：
   主节点定期向从节点发送心跳消息，检测从节点的在线状态。当发现从节点故障或长时间未响应时，主节点可能触发故障转移机制，选举新的从节点或调整复制策略。

**从节点（Slave）**：

1. **数据复制**：
   从节点接收主节点发送的数据变更信息，并在本地执行相同的变更操作，以保持与主节点的数据一致性。从节点通常以只读模式运行，不允许直接写入数据。
2. **读请求处理**：
   从节点负责处理部分或全部的读请求，减轻主节点的压力。由于数据复制有一定的延迟，从节点返回的数据可能稍滞后于主节点，适用于对数据新鲜度要求不苛刻的场景。
3. **故障恢复准备**：
   从节点随时准备在主节点故障时晋升为主节点，提供服务。这可能涉及数据完整性检查、复制偏移量跟踪、故障切换脚本等准备工作。

**复制拓扑与一致性**：

1. **单主多从**：
   最常见的主从模型是一个主节点对应多个从节点。这种方式可以实现数据的多份备份，提高数据的可用性。同时，多个从节点可以分摊读取负载，改善系统的读性能。
2. **级联复制**：
   在某些场景下，从节点还可以充当其他从节点的主节点，形成级联复制拓扑。级联复制可以进一步分散复制压力，但可能导致数据一致性延迟增大。
3. **数据一致性**：
   主从模型通常实现最终一致性，即在一定时间内，从节点的数据会与主节点一致。根据系统需求和复制策略，可以实现不同程度的一致性保证，如强同步复制、半同步复制、异步复制等。

**故障转移与高可用**：

1. **故障检测与转移**：
   当主节点故障时，系统需要能够快速检测到故障并启动故障转移流程。这可能涉及Zookeeper、Paxos、Raft等分布式一致性算法，或者简单的主备切换脚本。
2. **自动选主**：
   在故障转移过程中，从节点之一可能被选举为新的主节点。选举算法需要考虑节点的健康状况、数据同步进度、网络延迟等因素，确保新主节点能够提供正确的服务。
3. **数据恢复与重同步**：
   新主节点确立后，其他从节点需要与其重新建立复制关系，同步缺失的数据。在某些情况下，可能需要人工干预进行数据恢复。

**主从模型的应用场景**：

1. **数据备份与恢复**：
   主从模型可用于定期备份数据，以防止单点故障导致数据丢失。在主节点故障时，可以从从节点恢复数据。
2. **读写分离**：
   利用主节点处理写请求，从节点处理读请求，可以提高系统的并发处理能力，特别是对于读多写少的场景。
3. **异地多活与容灾**：
   在不同的地理位置部署主从节点，可以实现跨地域的数据复制与服务提供，提高系统的地域容灾能力。